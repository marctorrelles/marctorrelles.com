import { styled } from "styled-components"
import { darkTheme, lightTheme } from "../../styles/theme"
import { AnimatePresence, motion } from "framer-motion"
import { useEffect, useState } from "react"

type Props = {
  lastClap: number
}

const Svg = motion(styled.svg`
  width: 2rem;
  height: 2rem;
  fill: ${lightTheme.secondary};
  @media (prefers-color-scheme: dark) {
    fill: ${darkTheme.secondary};
  }
`)

const Path = motion.path

let timer: NodeJS.Timeout

export default function ClapIcon({ lastClap }: Props) {
  const [clapped, setClapped] = useState(false)

  useEffect(() => {
    clearTimeout(timer)

    if (lastClap) {
      setClapped(true)
      timer = setTimeout(() => {
        setClapped(false)
      }, 1500)

      return () => {
        clearTimeout(timer)
      }
    }
  }, [lastClap])

  return (
    <Svg
      fill="#000000"
      height="24px"
      width="24px"
      viewBox="0 0 117 117"
      variants={{
        clapped: {
          scale: 1.2,
        },
        unclapped: {
          scale: 1,
        },
      }}
      initial="unclapped"
      animate={clapped ? "clapped" : "unclapped"}
      key={lastClap}
      layout
    >
      <g>
        <AnimatePresence mode="sync">
          {clapped && (
            <>
              <Path
                d="M76.7811 18.2812V3.65625C76.7811 1.64531 75.1358 0 73.1249 0C71.1139 0 69.4686 1.64531 69.4686 3.65625V18.2812C69.4686 20.2922 71.1139 21.9375 73.1249 21.9375C75.1358 21.9375 76.7811 20.2922 76.7811 18.2812Z"
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
              />
              <Path
                d="M61.5391 16.2475L54.2266 5.27871C53.1069 3.61055 50.8218 3.15352 49.1536 4.27324C47.4854 5.39297 47.0284 7.65527 48.1481 9.34629L55.4606 20.315C56.5803 21.9832 58.8655 22.4402 60.5337 21.3205C62.2018 20.2008 62.6589 17.9385 61.5391 16.2475Z"
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
              />
              <Path
                d="M98.1016 9.34629C99.2214 7.65527 98.7872 5.39297 97.0962 4.27324C95.4051 3.15352 93.1428 3.58769 92.0231 5.27871L84.7106 16.2475C83.5909 17.9385 84.0251 20.2008 85.7161 21.3205C87.4071 22.4402 89.6694 22.0061 90.7891 20.315L98.1016 9.34629Z"
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
              />
            </>
          )}
        </AnimatePresence>
        <path d="M30.8495 27.1934C32.9975 25.0453 36.471 25.0453 38.5962 27.1934L66.8864 55.4607C69.1944 57.7687 73.1249 56.1234 73.1249 52.8785V43.875C73.1249 39.8303 76.3927 36.5625 80.4374 36.5625C84.4821 36.5625 87.7499 39.8303 87.7499 43.875V78.975C87.7499 92.0232 80.8944 104.112 69.72 110.83C55.095 119.605 36.4024 117.297 24.3597 105.254L1.5995 82.4941C-0.548547 80.3461 -0.548547 76.8726 1.5995 74.7475C3.74755 72.6223 7.22098 72.5994 9.34618 74.7475L21.4575 86.8588C22.8515 88.2527 25.1138 88.2527 26.5077 86.8588C27.9016 85.4648 27.9016 83.2025 26.5077 81.8086L5.25575 60.5566C3.1077 58.4086 3.1077 54.9352 5.25575 52.81C7.4038 50.6848 10.8772 50.6619 13.0024 52.81L34.2544 74.0619C35.6483 75.4559 37.9106 75.4559 39.3046 74.0619C40.6985 72.668 40.6985 70.4057 39.3046 69.0117L12.5682 42.2754C10.4202 40.1273 10.4202 36.6539 12.5682 34.5287C14.7163 32.4035 18.1897 32.3807 20.3149 34.5287L47.0513 61.265C48.4452 62.659 50.7075 62.659 52.1015 61.265C53.4954 59.8711 53.4954 57.6088 52.1015 56.2148L30.8495 34.9629C28.7015 32.8148 28.7015 29.3414 30.8495 27.2162V27.1934ZM98.97 110.807C93.4399 114.121 87.3386 115.857 81.2143 116.086C92.2059 107.037 98.7186 93.4629 98.7186 78.975V56.5576C100.592 56.5348 102.375 55.0951 102.375 52.9014V43.875C102.375 39.8303 105.643 36.5625 109.687 36.5625C113.732 36.5625 117 39.8303 117 43.875V78.975C117 92.0232 110.144 104.112 98.97 110.83V110.807Z" />
      </g>
    </Svg>
  )
}
